<!doctype html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bootstrap demo</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ˜µâ€ğŸ’«</text></svg>" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <script type="importmap">
      {
        "imports": {
          "#signals": "./signals.js",
          "#Rectangle": "./Rectangle.js",
          "#Revision": "./Revision.js",
          "#Watcher": "./Watcher.js"
        }
      }
    </script>
  </head>
  <body>




    <div class="container text-center">

      <div class="row pt-5 justify-content-center">

        <div class="col-sm-12 col-md-8 col-lg-6 pt-5">

          <div class="alert alert-info mb-3 w-100" role="alert">
            <i class="bi bi-exclamation-triangle-fill"></i> The value of the counter is <var id="counterValueElement"></var>
            <div>
              <pre id="counterValueRevisionElement" class="text-truncate" style="font-size: 9px;"></pre>
            </div>
            <hr>
            <small>
              Application Revision <small>(set by imaginary server)</small>
              <pre id="appRevisionElement" class="text-truncate" style="font-size: 9px;"></pre>
            </small>
          </div>

          <div class="card w-100">


            <div class="card-body">
              <h5 id="comment" class="card-title">Counter Example</h5>
              <input id="numberInput" type="number">
              <p class="card-text"></p>
              <a href="index.html" class="btn btn-secondary">&laquo; Return</a>
              <button id="countButton" class="btn btn-primary">Count <i class="bi bi-sort-numeric-up"></i></button>
            </div>

          </div>

        </div>

      </div>

    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
    <script type="module">
      /* JavaScript module code here */

      import Revision from "#Revision";
      import Watcher from "#Watcher";


      class Application {

        // Appliciaon Revision
        rev = new Revision(null, 4523); // let us imagine revision 4523 was set by the server

        // we pair the value and revision
        counterValue = 0; // this is non reactive, nust a plain old number
        counterValueRevision = new Revision(); // this only holds revision value

        // start: class constructor
        constructor(){

          // we perform two operations update the revion number of the variable and the application revision
          return Watcher.watch(this, ['counterValue' ], memberName=> this[memberName+'Revision'].inc()&&this.rev.inc() );
        }

      }

      // instantiate the application - nothing special here
      const myLittleApp = new Application();

      // Standard Bworser Operation - nothing here indicates reactive programming

      // please note we simply increment a number here, however, that number is being secretly watched!
      countButton.addEventListener('click', () => myLittleApp.counterValue++ ); // <--------- THIS IS SPECIAL, it is normal code, but the watcher increments the counterValueRevision that we listen to later

      // listen to the numeric UI component changes
      numberInput.addEventListener('change', event => myLittleApp.counterValue = event.target.value );













      // PARTY TIME! Going Reactive - we listen to the revision

      // the revision update is triggered by the watcher
     // send data to input box
      myLittleApp.counterValueRevision.subscribe(()=> numberInput.value = myLittleApp.counterValue )


      // show the values in the alert!
      myLittleApp.counterValueRevision.subscribe(()=> counterValueElement.innerText = myLittleApp.counterValue );
      myLittleApp.counterValueRevision.subscribe(([rev, uuid])=> counterValueRevisionElement.innerText = `rev: ${rev}, uuid: ${uuid}`);
      myLittleApp.rev.subscribe(([rev, uuid])=> appRevisionElement.innerText = `rev: ${rev}, uuid: ${uuid}`);


    </script>
  </body>
</html>
